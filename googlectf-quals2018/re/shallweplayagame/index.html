



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Our CTF writeups">
      
      
        <link rel="canonical" href="https://osilayer8.makerforce.io/googlectf-quals2018/re/shallweplayagame/">
      
      
        <meta name="author" content="OSI Layer 8">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.2">
    
    
      
        <title>Shall we play a game - OSI Layer 8</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#03a9f4">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="light-blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#googlectf-quals-2018-shall-we-play-a-game-re-113-points-111-solves" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://osilayer8.makerforce.io/" title="OSI Layer 8" class="md-header-nav__button md-logo">
          
            <img src="../../../img/logo_white.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              OSI Layer 8
            </span>
            <span class="md-header-nav__topic">
              
                Shall we play a game
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/nushosilayer8/writeups/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    nushosilayer8
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://osilayer8.makerforce.io/" title="OSI Layer 8" class="md-nav__button md-logo">
      
        <img src="../../../img/logo_white.svg" width="48" height="48">
      
    </a>
    OSI Layer 8
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/nushosilayer8/writeups/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    nushosilayer8
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      CrossCTF 2018 Qualifiers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        CrossCTF 2018 Qualifiers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-quals2018/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-quals2018/CYOA/" title="CYOA" class="md-nav__link">
      CYOA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-quals2018/pwn/evenflow/" title="Even Flow" class="md-nav__link">
      Even Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-quals2018/pwn/impossible_shellcoding/" title="Impossible Shellcoding" class="md-nav__link">
      Impossible Shellcoding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-quals2018/crypto/BabyRSA/" title="BabyRSA" class="md-nav__link">
      BabyRSA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-quals2018/crypto/BabyRSA2/" title="BabyRSA 2" class="md-nav__link">
      BabyRSA 2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-quals2018/crypto/lossyoracle/" title="LossyOracle" class="md-nav__link">
      LossyOracle
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      CrossCTF 2018 Finals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        CrossCTF 2018 Finals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Pwn
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Pwn
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/pwn/ftlog/" title="FTLOG" class="md-nav__link">
      FTLOG
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/pwn/slowmo/" title="Slowmo" class="md-nav__link">
      Slowmo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/pwn/cocacola/" title="Coca Cola" class="md-nav__link">
      Coca Cola
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/pwn/gruffybear/" title="GruffyBear" class="md-nav__link">
      GruffyBear
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/pwn/souvlaki/" title="Souvlaki Space Station" class="md-nav__link">
      Souvlaki Space Station
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Reversing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Reversing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/re/perfect/" title="Perfect" class="md-nav__link">
      Perfect
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/re/rochefort6/" title="Tower Of Beer: Rochefort 6" class="md-nav__link">
      Tower Of Beer: Rochefort 6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/re/rochefort8/" title="Tower Of Beer: Rochefort 8" class="md-nav__link">
      Tower Of Beer: Rochefort 8
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/re/iamrusty/" title="iamrusty" class="md-nav__link">
      iamrusty
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Web
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Web
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/web/gocoin/" title="GoCoin!" class="md-nav__link">
      GoCoin!
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/web/gocoinplus/" title="GoCoin! Plus" class="md-nav__link">
      GoCoin! Plus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/web/gocoinplusplus/" title="GoCoin! Plus Plus" class="md-nav__link">
      GoCoin! Plus Plus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/web/terminal/" title="The Terminal" class="md-nav__link">
      The Terminal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/web/retroweb/" title="RetroWeb" class="md-nav__link">
      RetroWeb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/web/cachecreek/" title="CacheCreek" class="md-nav__link">
      CacheCreek
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      Crypto
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        Crypto
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/crypto/fitblips/" title="Fitblips" class="md-nav__link">
      Fitblips
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/crypto/babyrsa3/" title="BabyRSA" class="md-nav__link">
      BabyRSA
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6">
    
    <label class="md-nav__link" for="nav-3-6">
      Misc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-6">
        Misc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/misc/evil/" title="The Evilness" class="md-nav__link">
      The Evilness
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/misc/cyoa/cyoa.py" title="Choose Your Own Adventure" class="md-nav__link">
      Choose Your Own Adventure
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Mobile
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Mobile
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../crossctf-finals2018/mobile/human/" title="Human Powered Flag Generator" class="md-nav__link">
      Human Powered Flag Generator
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      GoogleCTF 2018 Qualifiers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        GoogleCTF 2018 Qualifiers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2" checked>
    
    <label class="md-nav__link" for="nav-4-2">
      Reversing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Reversing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Shall we play a game
      </label>
    
    <a href="./" title="Shall we play a game" class="md-nav__link md-nav__link--active">
      Shall we play a game
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#static-analysis" class="md-nav__link">
    Static Analysis
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decompilation" class="md-nav__link">
    Decompilation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#native-library" class="md-nav__link">
    Native library
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    Solution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-frida" class="md-nav__link">
    Using Frida
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spawn-app-repeatedly" class="md-nav__link">
    Spawn app repeatedly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flag" class="md-nav__link">
    Flag
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Organising
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Organising
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/nushosilayer8/geekcamp2018plus-ctf" title="Geekcamp 2018+ CTF" class="md-nav__link">
      Geekcamp 2018+ CTF
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#static-analysis" class="md-nav__link">
    Static Analysis
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decompilation" class="md-nav__link">
    Decompilation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#native-library" class="md-nav__link">
    Native library
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    Solution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-frida" class="md-nav__link">
    Using Frida
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spawn-app-repeatedly" class="md-nav__link">
    Spawn app repeatedly
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flag" class="md-nav__link">
    Flag
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/nushosilayer8/writeups/edit/master/writeups/googlectf-quals2018/re/shallweplayagame/README.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="googlectf-quals-2018-shall-we-play-a-game-re-113-points-111-solves">GoogleCTF Quals 2018 : Shall we play a game (re, 113 points, 111 solves)</h1>
<h2 id="summary">Summary</h2>
<p>We are given an android <a href="app.apk">app</a> with a tic tac toe game. To obtain the flag, we need to win 1000000 times.</p>
<ul>
<li><a href="#static-analysis">Static Analysis</a></li>
<li><a href="#solution">Solution</a></li>
</ul>
<h2 id="static-analysis">Static Analysis</h2>
<p>The first thing I always do when getting an apk file (from a trusted source, of course) is to install it, to see what it is about. Since I have an Android device, it is very convenient for me to just use adb.</p>
<pre><code class="bash">$ adb install app.apk
</code></pre>

<p><img alt="screenshot" src="screenshot.jpg" /></p>
<h3 id="decompilation">Decompilation</h3>
<p>First, I used jadx to decompile the app and view its source.</p>
<p>Looking at AndroidManifest.xml, we see that GameActivity is the activity being launched at the start.</p>
<pre><code class="xml">...
    &lt;application android:theme=&quot;@style/AppTheme&quot; android:label=&quot;@string/app_name&quot; android:icon=&quot;@mipmap/ic_launcher&quot; android:name=&quot;android.support.multidex.MultiDexApplication&quot; android:allowBackup=&quot;true&quot; android:supportsRtl=&quot;true&quot; android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;&gt;
        &lt;activity android:name=&quot;com.google.ctf.shallweplayagame.GameActivity&quot;&gt;
...
</code></pre>

<p>In GameActivity.java, the function I'm interested in at the start is <code>onClick</code> and <code>onCreate</code>. Nothing much happens in <code>onCreate</code>, just some initialization. As for <code>onClick</code>, looks like it is performing some game logic.</p>
<p>Here's the code (variables and functions/methods are renamed by myself, if you want to look at the original source, it is <a href="jadx/app/sources/com/google/ctf/shallweplayagame/GameActivity.java">here</a>).</p>
<pre><code class="java">public void onClick(View view) {
    if (!this.hasLost &amp;&amp; this.animatorsQueue.isEmpty()) {
        CellView cellView = (CellView) view;
        if (cellView.isEmpty())) {
            soundController.playToneA();
            cellValue.setValue(CellView.X);
            if (won(CellView.X)) {
                updateScore();
                return;
            }
            List l = getListOfNonEmptyCells();
            if (l.isEmpty()) {
                updateScore();
                return;
            }
            getRandomElement(l).setValue(a.O);
            if (won(a.O)) {
                lost();
                return;
            } else {
                animate();
                return;
            }
        }
        soundController.playToneB();
    }
}

protected void onCreate(Bundle bundle) {
    super.onCreate(bundle);
    setContentView((int) R.layout.activity_game);
    LinearLayout linearLayout = (LinearLayout) findViewById(R.id.rows);
    for (int i = 0; i &lt; 3; i++) {
        View linearLayout2 = new LinearLayout(getApplicationContext());
        for (int i2 = 0; i2 &lt; 3; i2++) {
            View cell = new CellView(getApplicationContext(), this.m);
            linearLayout2.addView(cell);
            this.l[i2][i] = cell;
            cell.setOnClickListener(this);
        }
        linearLayout.addView(linearLayout2);
    }
}
</code></pre>

<p>There's nothing interesting in <code>animate</code> and <code>lost</code>, but <code>updateScore</code> seems to have something more than just updating the score. In particular, a list <code>byteArray1</code> is modifed during every call to <code>updateScore</code>, and I suspect this should contain the flag in some form. And when our score reaches 1,000,000, <code>showFlag</code> is invoked.</p>
<pre><code class="java">void updateScore() {
    for (int i = 0; i &lt; 3; i++) {
        for (int i2 = 0; i2 &lt; 3; i2++) {
            this.l[i2][i].setCellValue(a.EMPTY, 25);
        }
    }
    animate();
    this.score++;
    Object _ = N._(Integer.valueOf(2), N.e, Integer.valueOf(2));
    N._(Integer.valueOf(2), N.f, _, this.byteArray1);
    this.byteArray1 = (byte[]) N._(Integer.valueOf(2), N.g, _);
    if (this.score == 1000000) {
        showFlag();
        return;
    }
    ((TextView) findViewById(R.id.score)).setText(String.format(&quot;%d / %d&quot;, new Object[]{Integer.valueOf(this.score), Integer.valueOf(1000000)}));
}
</code></pre>

<p>Here, the app prints the flag, using values derived from <code>byteArray1</code> and <code>byteArray2</code>.</p>
<pre><code class="java">void showFlag() {
    Object _ = N._(Integer.valueOf(0), N.a, Integer.valueOf(0));
    Object _2 = N._(Integer.valueOf(1), N.b, this.byteArray1, Integer.valueOf(1));
    N._(Integer.valueOf(0), N.c, _, Integer.valueOf(2), _2);
    ((TextView) findViewById(R.id.score)).setText(new String((byte[]) N._(Integer.valueOf(0), N.d, _, this.byteArray2)));
    o();
}
</code></pre>

<p>Lots of variables from the <code>N</code> class are being referenced. Taking a peek at it tells us they are different constants. But something catches our eye, the native function <code>_</code>.</p>
<pre><code class="java">package com.google.ctf.shallweplayagame;

class N {
    static final int[] a = new int[]{0, 1, 0};
    static final int[] b = new int[]{1, 0, 2};
    static final int[] c = new int[]{2, 0, 1};
    static final int[] d = new int[]{3, 0, 0};
    static final int[] e = new int[]{4, 1, 0};
    static final int[] f = new int[]{5, 0, 1};
    static final int[] g = new int[]{6, 0, 0};
    static final int[] h = new int[]{7, 0, 2};
    static final int[] i = new int[]{8, 0, 1};

    static {
        System.loadLibrary(&quot;rary&quot;);
    }

    static native Object _(Object... objArr);
}
</code></pre>

<h3 id="native-library">Native library</h3>
<p>To obtain the native library shared object file, I used apktool to disassemble the app. </p>
<p><em>apktool gives smali files, but also contains shared object files, whereas jadx gives java files but there is no shared object file</em></p>
<pre><code class="bash">$ java -jar ~/Downloads/apktool_2.3.3.jar d auto_solve.apk
</code></pre>

<p>Opening up the shared object file in IDA, my immediate thought is to not reverse it. Because <code>_</code> was an overloaded function, it seems like the native function does some type checking on the arguments before performing more complex operations on it, which involves a lot of other functions.</p>
<h2 id="solution">Solution</h2>
<p>Clearly, what we need to do now is to run <code>updateScore()</code> 1,000,000 times. There are a few ways to this. </p>
<ol>
<li>Patching the smali file and build it back to an apk file, then install it.</li>
<li>Create a new Android project in Android Studio, and manually add all the relevant files, including native libraries, so this will be somewhat troublesome.</li>
<li>Use frida to hook <code>onCreate</code> and run <code>updateScore()</code> directly from there.</li>
</ol>
<p><strong>Why can't we just edit the .java file and build it directly?</strong></p>
<p>Because jadx <strong>decompiles</strong> the apk file, which means code is reconstructed using some heuristics, and does not preserve the project structure used by Android projects. So, we need to create a new Android project ourselves and add in all the stuff needed manually.</p>
<p>On the other hand, apktool <strong>disassembles</strong> the apk file, which means it does not do any code generation by itself, preserving the project structure so it can easily build a patched apk file from that.</p>
<h3 id="using-frida">Using Frida</h3>
<p>I decided to use Frida as I didn't really feel like messing with the smali code at the time (wasn't very hard actually, someone else in the team did it).</p>
<p>I figured the most convenient way to do it is to hook <code>onCreate</code>, let it initialize the stuff it needs, and then call <code>n()</code> 1000000 times from there. (<code>n</code> is the original function name of <code>updateScore</code>, <code>m</code> is <code>showFlag</code>)</p>
<p><em>frida uses javascript to do instrumentation</em></p>
<pre><code class="js">Java.perform(function() {
    var GameActivity = Java.use('com.google.ctf.shallweplayagame.GameActivity');

    GameActivity.onCreate.overload('android.os.Bundle').implementation = function (v) {
        this.onCreate(v)
        for (var i = o; i &lt; 1000000; i++) {
            send(i);
            this.n();
        }
    };
})
</code></pre>

<p>Then, set up a Frida python script to run it.</p>
<pre><code class="python">def on_message(message, data):
    global i, q, changed
    if message['type'] == 'send':
        print(&quot;[*] {0}&quot;.format(message['payload']))

print('[*] Spawning app')
device = frida.get_usb_device()
pid = device.spawn('com.google.ctf.shallweplayagame')
session = device.attach(pid)
jscode = open('script.js', 'r').read()
script = session.create_script(jscode)
script.on('message', on_message)
print('[*] Running script')
script.load()
device.resume(pid)
</code></pre>

<p>All looks good... until when it reaches around 10000 the app crashes. I suppose maybe using such a hooking approach may mess up garbage collection in the app, causing it to run out of memory.</p>
<h3 id="spawn-app-repeatedly">Spawn app repeatedly</h3>
<p>However, this is rather simply to deal with. I modified the js script to only run <code>n()</code> up to 10000 times, then dump the values of <code>score</code> and <code>byteArray1</code>, and store them in a global variable. Then, re-run the app and load those values into <code>score</code> and <code>byteArray1</code> to continue where we ended off.</p>
<pre><code class="python">i = 0
q = []

def on_message(message, data):
    global i, q, changed
    if message['type'] == 'send':
        print(&quot;[*] {0}&quot;.format(message['payload']))
        i = message['payload'][0]
        q = message['payload'][1]
        changed = True
</code></pre>

<p>Using a while loop, we can keep spawning the app until we get the flag.</p>
<pre><code class="python">while True:
    if i &gt; 1000000:
        exit(0)

    while not changed:
        pass

    changed = False

    jscode = &quot;&quot;&quot;
Java.perform(function() {
    var GameActivity = Java.use('com.google.ctf.shallweplayagame.GameActivity');
    o = %d

    GameActivity.onCreate.overload('android.os.Bundle').implementation = function (v) {
        this.onCreate(v)
        %s
        if (o &lt; 1000000) {
            for (var i = o; i &lt; o + 20000; i++) {
                this.n();
            }
            send([i, this.q.value]);
        }
        else {
            this.m();
        }
    };

    GameActivity.k.implementation = function () {
    };
})
&quot;&quot;&quot; % (i, &quot;this.q.value = Java.array('byte', %s)&quot; % q if i &gt; 0 else '')

    print('Spawning app')
    device = frida.get_usb_device()
    pid = device.spawn('com.google.ctf.shallweplayagame')
    session = device.attach(pid)
    script = session.create_script(jscode)
    script.on('message', on_message)
    print('[*] Running script')
    script.load()
    device.resume(pid)
</code></pre>

<p>Full script <a href="solve.py">here</a>.</p>
<h3 id="flag">Flag</h3>
<p>This approach was really slow, it took around half an hour to finally get the flag. In contrast, if I'd just modified the smali code, it would have been complete in less than a second.</p>
<p>Nevertheless, I still preferred this solution as it is very easy to code. Then, I can just leave the script to run while doing some other stuff, and come back half an hour to get the flag. Unless I'm familiar with smali, it would have taken some brain effort to modify the code to get the flag.</p>
<p><img alt="flag" src="flag.jpg" /></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../" title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c648116f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>